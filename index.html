<!DOCTYPE html>
<html>
<head>
    <title>Cyber ID Lookup</title>
    <style>
        .container {
            width: 600px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background: white;
            text-align: center;
        }
        input {
            width: 450px;
            padding: 12px;
            font-size: 14px;
            margin: 10px 0;
        }
        button {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            text-align: left;
        }
        .cyber-id-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .cyber-id-image {
            max-width: 200px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .cyber-id-name {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #2196F3;
        }
        .cyber-id-desc {
            color: #666;
            margin: 10px 0;
        }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Cyber ID Lookup</h2>
        <input id="addressInput" type="text" 
               placeholder="Enter wallet address (0x...)"
               value="0x05A7Eb929209F5C1F2f08dd087b64bB1beBa99fE">
        <div>
            <button id="lookupBtn">Get Cyber ID</button>
        </div>
        <div id="result"></div>
    </div>

    <script>
        const API_KEY = '3ccb00e2-963e-492a-bf0e-b4f5546e6c3c';
        const API_HOST = 'https://api.socialscan.io/cyber/v1/developer/api';
        const CYBER_NFT_CONTRACT = '0xc137be6b59e824672aada673e55cf4d150669af8';
        const METADATA_BASE_URL = 'https://metadata.cyberconnect.dev/nfts/cyberid/';

        async function fetchNFTTransfers(address) {
            const params = new URLSearchParams({
                module: 'account',
                action: 'tokennfttx',
                contractaddress: CYBER_NFT_CONTRACT,
                address: address,
                page: '1',
                offset: '100',
                startblock: '0',
                endblock: '999999999',
                sort: 'desc'
            });

            const response = await fetch(`${API_HOST}?${params}`, {
                headers: {
                    'x-api-key': API_KEY
                }
            });

            if (!response.ok) {
                throw new Error(`API request failed: ${response.statusText}`);
            }

            return await response.json();
        }

        async function fetchMetadata(tokenId) {
            const response = await fetch(`${METADATA_BASE_URL}${tokenId}`);
            if (!response.ok) {
                throw new Error('Failed to fetch metadata');
            }
            return await response.json();
        }

        function formatDate(timestamp) {
            return new Date(parseInt(timestamp)).toLocaleDateString();
        }

        window.onload = function() {
            document.getElementById('lookupBtn').onclick = async function() {
                const resultDiv = document.getElementById('result');
                const address = document.getElementById('addressInput').value;

                resultDiv.innerHTML = 'Looking up...';

                try {
                    // Get NFT transfers
                    const nftData = await fetchNFTTransfers(address);

                    if (nftData.result && nftData.result.length > 0) {
                        // Find last transfer to this address
                        const lastTransfer = nftData.result.find(tx => 
                            tx.to.toLowerCase() === address.toLowerCase()
                        );

                        if (lastTransfer) {
                            // Get metadata
                            const metadata = await fetchMetadata(lastTransfer.tokenID);
                            
                            resultDiv.innerHTML = `
                                <div class="cyber-id-card">
                                    <div class="cyber-id-name">${metadata.name}</div>
                                    <img class="cyber-id-image" src="${metadata.image}" 
                                         alt="${metadata.name}" 
                                         onerror="this.src='/api/placeholder/200/200'"/>
                                    <div class="cyber-id-desc">${metadata.description}</div>
                                    <div>Created: ${formatDate(metadata.attributes.find(a => a.trait_type === 'Created Date')?.value)}</div>
                                    <div>Token ID: ${lastTransfer.tokenID}</div>
                                </div>
                            `;
                        } else {
                            resultDiv.innerHTML = '<div class="error">No active Cyber ID found for this address</div>';
                        }
                    } else {
                        resultDiv.innerHTML = '<div class="error">No Cyber ID transfers found for this address</div>';
                    }

                } catch (error) {
                    console.error('Error:', error);
                    resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                }
            };
        };
    </script>
</body>
</html>
